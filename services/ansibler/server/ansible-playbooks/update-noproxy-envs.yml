---
- hosts: control
  gather_facts: true
  become: true
  tasks:
    - name: Update NO_PROXY and no_proxy in kube-proxy DeamonSet
      ansible.builtin.shell: |
        NO_PROXY="{{ no_proxy }}" no_proxy="{{ no_proxy }}" kubeadm init phase addon kube-proxy

    - name: Update NO_PROXY and no_proxy in static pods
      ansible.builtin.shell: |
        NO_PROXY="{{ no_proxy }}" no_proxy="{{ no_proxy }}" kubeadm init phase control-plane all --patches .
