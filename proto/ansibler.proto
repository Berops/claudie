syntax = "proto3";
package claudie;
import "proto/config.proto";

option go_package = "proto/pb";

message InstallRequest {
  K8scluster desired = 1;
  repeated LBcluster desiredLbs = 2;
  string projectName = 3;
}
message InstallResponse {
  K8scluster desired = 1;
  repeated LBcluster desiredLbs = 2;
}

message SetUpLBRequest {
  K8scluster desired = 1;
  repeated LBcluster currentLbs = 2;
  repeated LBcluster desiredLbs = 3;
  string previousAPIEndpoint = 4;
  string projectName = 5;
}
message SetUpLBResponse {
  K8scluster desired = 1;
  repeated LBcluster currentLbs = 2;
  repeated LBcluster desiredLbs = 3;
}

message TeardownLBRequest {
  K8scluster desired = 1;
  repeated LBcluster desiredLbs = 2;
  repeated LBcluster deletedLbs = 3;
  string projectName = 4;
}

message TeardownLBResponse {
  string previousAPIEndpoint = 1;
  K8scluster desired = 2;
  repeated LBcluster desiredLbs = 3;
  repeated LBcluster deletedLbs = 4;
}

service AnsiblerService {
  //InstallNodeRequirements installs any requirments there are on all of the nodes
  rpc InstallNodeRequirements(InstallRequest) returns (InstallResponse);
  //InstallVPN installs VPN between nodes in the k8s cluster and lb clusters
  rpc InstallVPN(InstallRequest) returns (InstallResponse);
  //SetUpLoadbalancers sets up the loadbalancers, DNS and verifies their configuration
  rpc SetUpLoadbalancers(SetUpLBRequest) returns (SetUpLBResponse);
  //TeardownLoadBalancers correctly destroys loadbalancers including selecting the new ApiServer endpoint
  rpc TeardownLoadBalancers(TeardownLBRequest) returns (TeardownLBResponse);
}
